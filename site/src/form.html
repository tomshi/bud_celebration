<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, width=device-width, user-scalable=yes, minimal-ui">
    <title>百威庆祝</title>

    <!-- build:css css/main.css -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="bower_components/cropper/dist/cropper.min.css">
    <!-- endbuild -->

    <!-- build:js js/vendor.js -->
    <script src="bower_components/modernizr/modernizr.js"></script>
    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <!-- endbuild -->

    <meta name="renderer" content="webkit">
    <meta name="google" value="notranslate">
</head>
<body>

    <div id="wrapper">

        <section id="stage">
            <div class="frame" id="form" style="display: block;">
                <div class="header">
                    <div class="text1"><img src="img/form-text1.png" class="responsive" alt=""/></div>
                    <div class="headline"><img src="img/form-headline.png" class="responsive" alt=""/></div>
                    <div class="text2"><img src="img/form-text2.png" class="responsive" alt=""/></div>
                </div>
                <div class="form">
                    <div class="input name">
                        <input type="text" id="username" name="username" placeholder="为谁欢庆" value=""/>
                    </div>
                    <div class="input type">
                        <input type="text" id="occasion" name="occasion" placeholder="庆祝什么" value=""/>
                        <ul class="type-list" id="type-list">
                            <li>生曰快乐</li>
                            <li>新年快乐</li>
                        </ul>
                    </div>
                    <div class="input time">
                        <input type="text" id="time" name="time" placeholder="在哪一天" value=""/>
                    </div>
                    <a href="##" class="submit" id="submit"></a>
                    <div class="upload" id="crop-avatar">
                        <div class="avatar-upload">
                            <input class="avatar-src" name="avatar_src" type="hidden">
                            <input class="avatar-data" name="avatar_data" type="hidden">
                            <input class="avatar-input file" id="avatarInput" name="avatar_file" type="file">
                            <div class="text">+ 上传一张照片，获得更专属的体验</div>
                        </div>
                        <div class="upload-failed" style="display: none">
                            <div class="text">上传失败</div>
                        </div>
                        <div class="upload-succeed" style="display: none">
                            <div class="text">上传成功<a style="margin-left: 10%" href="javascript:void(0)">更改照片</a></div>
                            <div class="avatar-view" title="Change the avatar">
                                <img src="img/picture.jpg" width="20%" alt="Avatar">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <div id="hand"><img src="img/hand.png"></div>

    </div>

    <div class="overlay">
        <div class="table">
            <div id="avatar-modal" class="table-cell">
                <form class="avatar-form" action="api/crop/crop-avatar.php" enctype="multipart/form-data" method="post">
                    <div class="avatar-wrapper"></div>
                    <a href="##" class="close-overlay">取消</a>
                    <a href="##" class="avatar-save">保存</a>
                </form>
            </div>
        </div>
    </div>
    <div class="loading" aria-label="Loading" role="img" tabindex="-1"></div>

    <!-- build:js js/plugins.js -->
    <script src="bower_components/velocity/velocity.min.js"></script>
    <script src="bower_components/letteringjs/jquery.lettering.js"></script>
    <script src="bower_components/cropper/dist/cropper.min.js"></script>
    <!-- endbuild -->

    <!-- build:js js/main.js -->
    <script src="js/preload.js"></script>
    <script src="js/main.js"></script>
    <script src="js/bottle.js"></script>
    <script src="js/toast.js"></script>
    <script src="js/toy.js"></script>
    <script src="js/tracking.js"></script>
    <script src="js/sharing.js"></script>
    <script src="js/wechatSharing.js"></script>
    <script src="js/crop-avatar.js"></script>
    <!-- endbuild -->

    <script type="text/javascript">
        function activeSubmitButton(){
            if($("#username").val() !== "" && $("#occasion").val() !== "" && $("#time").val() !== ""){
                $("#submit").addClass("active");
            }else {
                $("#submit").removeClass("active");
            }
        }
        $(function(){
            $(".input input").bind("focus", function(){
                var $this = $(this);
                var inputName = $this.attr("name");
                if (inputName == "occasion"){
                    $("#type-list").slideDown();
                }else if (inputName == "time") {
                    $this.attr("placeholder", "日日/月月");
                }else {}
                $this.parent().addClass("focus");
            }).bind("blur", function(){
                $(this).parent().removeClass("focus");
                $("#time").attr("placeholder", "在哪一天");
                $("#type-list").slideUp();
            }).bind("change", function(){
                activeSubmitButton();
            }).bind("keyup", function(){
                activeSubmitButton();
            });

            $("#type-list li").bind("click", function(){
                var val = $(this).text();
                $("#occasion").val(val);
                $("#type-list").slideUp();
            });

            $(".close-overlay").bind("click", function(){
                $(".overlay").fadeOut();
            });

            $(".avatar-save").bind("click", function(){
                $(".avatar-form").submit();
            });

            $("#submit").bind("click", function(){
                if ($("#submit").hasClass("active")) {
                    $.ajax({
                        type: "POST",
                        url: "api/user/save.json",
                        dataType: "json",
                        data: {
                            username: $("#username").val(),
                            purpose: $("#occasion").val(),
                            date: $("#time").val(),
                            image: $("#avatarInput").val()
                        },
                        success: function(data) {
                            //
                        }
                    }).done(function( msg ) {
                        alert( "Data Saved: " + msg );
                        if (data == 0){
                            //
                        }
                    });
                }
            });
        });
    </script>

</body>
</html>